using System.DirectoryServices.AccountManagement;
using Microsoft.AspNetCore.Mvc;

[ApiController]
[Route("api/[controller]")]
public class UserInfoController : ControllerBase
{
    [HttpGet]
    public IActionResult GetUserInfo()
    {
        string domainAndUsername = User?.Identity?.Name ?? "Null";

        var result = new
        {
            Username = domainAndUsername,
            FirstName = "Unknown",
            LastName = "Unknown"
        };

        if (domainAndUsername != "Null")
        {
            using (var context = new PrincipalContext(ContextType.Domain))
            {
                var user = UserPrincipal.FindByIdentity(context, domainAndUsername);
                if (user != null)
                {
                    result = new
                    {
                        Username = domainAndUsername,
                        FirstName = user.GivenName ?? "Unknown",
                        LastName = user.Surname ?? "Unknown"
                    };
                }
            }
        }

        return Ok(result);
    }
}
