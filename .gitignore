using Microsoft.AspNetCore.Mvc;
using System.DirectoryServices.AccountManagement;

[ApiController]
[Route("api/[controller]")]
public class UserInfoController : ControllerBase
{
    [HttpGet]
    public IActionResult GetUserInfo()
    {
        string domainAndUsername = User?.Identity?.Name ?? "Null";
        string firstName = "Unknown";
        string lastName = "Unknown";

        if (OperatingSystem.IsWindows() && domainAndUsername != "Null")
        {
            using (var context = new PrincipalContext(ContextType.Domain))
            {
                var user = UserPrincipal.FindByIdentity(context, domainAndUsername);
                if (user != null)
                {
                    firstName = user.GivenName ?? "Unknown";
                    lastName = user.Surname ?? "Unknown";
                }
            }
        }

        var result = new
        {
            Username = domainAndUsername,
            FirstName = firstName,
            LastName = lastName
        };

        return Ok(result);
    }
}

